<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/google-chart/google-chart.html">

<link rel="import" href="/bower_components/px-vis-timeseries/px-vis-timeseries.html" />
<link rel="import" href="/bower_components/px-vis/px-vis-data-converter.html" />

<dom-module id="normal-view">
  <template>
    <style include="shared-styles">
       :host {
        display: block;

        padding: 10px;
      }

      .thread-chart-container {
        display: inline-block;
      }

      .thread-chart--legend--label {
        font-size: .8em;
        color: #333;
        margin-right: 1em;
      }

      .thread-chart--legend--line {
        padding-left: .5em;
        padding-right: .5em;
        margin-right: .25em;
        position: relative;
        top: -.5em;
      }
    </style>


    <div class="card">



      <px-vis-timeseries prevent-resize width="800" height="500" chart-data="[[chartData]]" series-config="[[seriesConfig]]">
      </px-vis-timeseries>

      <px-vis-data-converter id="converter" data-key="series" id-key="name" original-data="[[originalData]]" chart-data="{{chartData}}"
        series-config="{{seriesConfig}}">
      </px-vis-data-converter>


      <div class="circle">1</div>
      <h2>Raw Data</h2>
      <p>Show all raw data from generator</p>

      <div id="main">
        <template is="dom-if" if="{{rawChartData.cols.length}}">
          <div class="thread-chart--legend">
            <template is="dom-repeat" items="{{rawChartData.cols}}" filter="chartColFilter">
              <span class="thread-chart--legend--line" style="border-bottom: 2px solid {{item.color}}"></span><span class="thread-chart--legend--label">{{item.label}}</span>
            </template>
          </div>
          <google-chart width="800px" height="400px" class="thread-chart" type='line' options="{{rawChartDataOverrideOptions}}" cols="{{rawChartData.cols}}"
            rows="{{rawChartData.rows}}">
          </google-chart>
        </template>
      </div>

    </div>


    <div class="card">

      <div class="circle">2</div>
      <h2>Correlations</h2>
      <p>Show all correlations for all data series permutation pairs</p>
      <p>Correlations above an absolute value of 0.8 will be "threaded" together</p>

      <div class="thread-chart--legend">
        <template is="dom-repeat" items="{{correlationData.cols}}" filter="chartColFilter">
          <span class="thread-chart--legend--line" style="border-bottom: 2px solid {{item.color}}"></span><span class="thread-chart--legend--label">{{item.label}}</span>
        </template>
      </div>
      <google-chart width="800px" height="400px" type='bar' options="{{correlationDataOverrideOptions}}" cols="{{correlationData.cols}}"
        rows="{{correlationData.rows}}">
      </google-chart>

    </div>


    <div class="card">

      <div class="circle">3</div>
      <h2>Subscribe to Series 'a' and 'b'</h2>
      <p>Show all "threads" that contain 'a' or 'b' and any correlated series (threaded data)</p>

      <div id="main">
        <template is="dom-repeat" items="{{threads}}">
          <div class="thread-chart-container">
            <template is="dom-if" if="{{item.cols.length}}">
              <div class="thread-chart--legend">
                <template is="dom-repeat" items="{{item.cols}}" filter="chartColFilter">
                  <span class="thread-chart--legend--line" style="border-bottom: 2px solid {{item.color}}"></span><span class="thread-chart--legend--label">{{item.label}}</span>
                </template>
              </div>
              <google-chart class="thread-chart" type='line' options="{{threadChartOverrideOptions}}" cols="{{item.cols}}" rows="{{item.rows}}">
              </google-chart>
            </template>
          </div>
        </template>
        <div id="linechart_material" width="800px" height="400px"></div>
      </div>

    </div>


  </template>

  <script>
    class NormalView extends Polymer.Element {
      static get is() { return 'normal-view'; }

      static get properties() {

        return {
          originalData: {
            type: Array,
            value: [
              {
                series: [
                  [1397102460000, 11.4403],
                  [1397139660000, 13.1913],
                  [1397177400000, 12.8485],
                  [1397228040000, 10.975],
                  [1397248260000, 12.9377],
                  [1397291280000, 13.3795]
                ],
                max: 35.4784,
                min: 7.6531,
                id: 'a',
                name: 'a',
              }
            ]
          },
          threads: {
            type: Array,
            value: []
          },
          threadChartOverrideOptions: {
            type: Object,
            value: {
              legend: {
                position: 'none',
              },
              colors: ['#6c91c2', '#aaabbc', '#8b8982', '#c3c9e9', '#027EA7', '#BFBFBF', '#E8E8E8', '#EEC96A', '#C4A780', '#96BBBB', '#84C0C6', '#F8F4E3', '#E6D3A3'],
            }
          },
          correlationData: {
            type: Array,
            value: []
          },
          correlationDataOverrideOptions: {
            type: Object,
            value: {
              animation: {
                duration: 500
              },
              height: 300,
              width: 800,
              vAxis: {
                minValue: -1,
                maxValue: 1,
                ticks: [-1, -0.8, 0, 0.8, 1]
              },
              colors: ['#6c91c2', '#aaabbc', '#8b8982', '#c3c9e9', '#027EA7', '#BFBFBF', '#E8E8E8', '#EEC96A', '#C4A780', '#96BBBB', '#84C0C6', '#F8F4E3', '#E6D3A3'],
              legend: {
                position: 'none'
              },
              orientation: 'horizontal'
            }
          },
          rawChartData: {
            type: Object,
            value: {}
          },
          rawChartDataOverrideOptions: {
            type: Object,
            value: {
              colors: ['#6c91c2', '#aaabbc', '#8b8982', '#c3c9e9', '#027EA7', '#BFBFBF', '#E8E8E8', '#EEC96A', '#C4A780', '#96BBBB', '#84C0C6', '#F8F4E3', '#E6D3A3'],
              width: 800,
              legend: {
                position: 'none',
              },
            }
          }
        }
      }

      stringify(text) {
        return JSON.stringify(text);
      }

      updateOriginalData() {

        setTimeout(() => {

          let modifiedData = this.originalData;
          modifiedData[0].series.pop();
          let recentData = modifiedData[0].series[modifiedData[0].series.length - 1];
          modifiedData[0].series.push([recentData[0]+43020000, recentData[1]+1]);
          this.set('originalData', Object.assign({}, modifiedData));

        }, 2000)
      }

      /** 
       * Native lifecycle method
       **/
      connectedCallback() {
        super.connectedCallback();

        this.updateOriginalData();
      }

      chartColFilter(item, index) {
        return index !== 0;
      }

    }

    window.customElements.define(NormalView.is, NormalView);
  </script>
</dom-module>